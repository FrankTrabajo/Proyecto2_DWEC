<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de Lugares</title>
    <link rel="stylesheet" href="css/styleIndex.css"/>
</head>
<body>
    <header>
        <div class="barra-de-arriba">
            <div><!--Aqui el logo nombre o cosa--></div>
            <div class="botones">
                <a href="/mapa"><input type="button" value="Mapa"></a>
                <button id="loginbutton"><a href="/login">Iniciar sesión</a></button>
                <button id="registerbutton"><a href="/register">Registrarse</a></button>
                <button id="logoutbutton"></button>
            </div>
        </div>
        <div class="buscar">
            <input type="text" placeholder="Buscar lugares">
            <button><img src="img/lupa.png"></button>
        </div>
    </header>
    
    <main id="main">
        <div class="aside">
            <p>vivan los domingos</p>
        </div>
        <!-- Aqui los posts -->
        <div id="postContainer">

        </div>
    </main>
</body>
<script>

    //Confirmar usuario logueado
    fetch("/check-auth", { method: 'GET'})
    .then(response => response.json())
    .then(data => {
        if(data.logueado){
            document.getElementById('loginbutton').style.display = 'none';
            document.getElementById('registerbutton').style.display = 'none';
            document.getElementById('logoutbutton').style.display = 'inline-block';
        }else{
            document.getElementById('loginbutton').style.display = 'inline-block';
            document.getElementById('registerbutton').style.display = 'inline-block';
            document.getElementById('logoutbutton').style.display = 'none';
        }
    });

    document.getElementById('logoutbutton').textContent = "Cerrar sesion";
    document.getElementById('logoutbutton').addEventListener('click', logout);
    function logout(){
        fetch('/user/logout', {
            method: 'POST',
            credentials: 'same-origin'
        })
        .then(response => response.json())
        .then(data => {
            if(data.message === 'Sesion cerrada') {
                window.location.href = '/login';
            } else {
                alert('Error al cerrar sesión');
            }
        })
        .catch(err => console.error( 'Errro en el logout' + err))
    }

    fetch("/api/post/", {method:"get"})
        .then(response => response.json())
        .then(datos => {console.log(datos), pintarPOST(datos);})
        .catch(err => console.error(err));
    
    function pintarPOST (datos){
        if (datos != null){
            let main = document.getElementById("postContainer");
            for (let i in datos){
                if(datos[i]['photo']!=null){
                    main.innerHTML += `
                    <div id= "dp">
                        <p>${datos[i]['title']}</p>
                        <p>${datos[i]['description']}</p>
                        <img src="${datos[i]['photo']}"/>
                        <br>
                    </div>
                `; 
                }else{
                    main.innerHTML += `
                    <div id= "dp">
                        <p>${datos[i]['title']}</p>
                        <p>${datos[i]['description']}</p>
                        <br>
                    </div>
                `; 
                }
                
            }
        }
    }
</script>
</html>